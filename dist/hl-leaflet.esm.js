import e from"leaflet";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},n.apply(this,arguments)}var t={};function o(e){var n=e.getCenter(),t=e.getZoom(),o=e.getBounds().getNorthWest(),r=e.getBounds().getSouthEast();return new CustomEvent("hl-leaflet-moveend",{detail:{center:[n.lat,n.lng],zoom:t,bounds:[[o.lat,o.lng],[r.lat,r.lng]]}})}function r(e){return Array.prototype.slice.call(e)}function i(){return r(document.body.querySelectorAll(".hl-map")).map(function(e){var n,t,o,i,a=e.dataset,l={hlRender:null!=(n=a.hlRender)?n:"",hlCenter:JSON.parse(null!=(t=a.hlCenter)?t:"[0,0]"),hlZoom:JSON.parse(null!=(o=a.hlZoom)?o:"10"),hlPreserve:JSON.parse(null!=(i=a.hlPreserve)?i:"false"),markers:[]};return r(e.querySelectorAll(".hl-marker")).forEach(function(e){var n,t=e.dataset;l.markers.push({hlCenter:JSON.parse(null!=(n=t.hlCenter)?n:"[0,0]"),hlPopup:t.hlPopup})}),{config:l,configElement:e,renderElement:document.querySelector(l.hlRender)}})}function a(n){var t,o=n.map;void 0!==o&&(o.setView(n.config.hlCenter,n.config.hlZoom),(null==(t=o.options.layers)?void 0:t.find(function(e){return"© OpenStreetMap contributors"===e.options.attribution}))||e.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(o),o.eachLayer(function(n){n instanceof e.Marker&&n.removeFrom(o)}),n.config.markers.forEach(function(t){var r,i,a=null!=(r=t.hlCenter)?r:n.config.hlCenter,l=null!=(i=t.hlPopup)?i:"",c=e.marker(a);c.setIcon(e.icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]})),""!==l&&c.bindPopup(l),c.addTo(o)}))}function l(r){r.forEach(function(r){var i=r.configElement,l=r.renderElement,c=r.config;if(null!==l){var u=e.map(l);r.map=u,a(r),t[i.id]=n({},r,{configString:JSON.stringify(c)}),u.on("moveend",function(){l.dispatchEvent(o(u))}),u.on("popupopen",function(e){var n={popup:e.popup.getElement()},t=new CustomEvent("hl-leaflet-popupopen",{detail:n});l.dispatchEvent(t)}),l.dispatchEvent(o(u))}})}function c(e){e.forEach(function(e){var n=t[e.configElement.id];if(void 0!==n&&void 0!==n.map){var o=JSON.stringify(e.config);o!=n.configString&&(n.config=e.config,n.configString=o,a(n))}})}window.addEventListener("load",function(){l(i()),new MutationObserver(function(){return c(i())}).observe(document.body,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["data-hl-center","data-hl-zoom","data-hl-render","data-hl-popup"]})});var u={findMaps:i,initMaps:l,updateMaps:c,mapCache:t,apply:a,syncMove:function(e,o){e.setAttribute("data-hl-center",JSON.stringify(o.center)),e.setAttribute("data-hl-zoom",JSON.stringify(o.zoom)),e.setAttribute("data-hl-bounds",JSON.stringify(o.bounds));var r=t[e.id];void 0!==r&&(r.config=n({},r.config,{hlCenter:o.center,hlZoom:o.zoom}),r.configString=JSON.stringify(r.config))}};export{u as default};
//# sourceMappingURL=hl-leaflet.esm.js.map
