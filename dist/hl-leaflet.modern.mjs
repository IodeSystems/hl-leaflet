import e from"leaflet";function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},t.apply(this,arguments)}const n={};function o(e){const t=e.getCenter(),n=e.getZoom(),o=e.getBounds().getNorthWest(),r=e.getBounds().getSouthEast();return new CustomEvent("hl-leaflet-moveend",{detail:{center:[t.lat,t.lng],zoom:n,bounds:[[o.lat,o.lng],[r.lat,r.lng]]}})}function r(e){return Array.prototype.slice.call(e)}function i(){return r(document.body.querySelectorAll(".hl-map")).map(e=>{var t,n,o,i;const a=e.dataset,l={hlRender:null!=(t=a.hlRender)?t:"",hlCenter:JSON.parse(null!=(n=a.hlCenter)?n:"[0,0]"),hlZoom:JSON.parse(null!=(o=a.hlZoom)?o:"10"),hlPreserve:JSON.parse(null!=(i=a.hlPreserve)?i:"false"),markers:[]};return r(e.querySelectorAll(".hl-marker")).forEach(e=>{var t;const n=e.dataset;l.markers.push({hlCenter:JSON.parse(null!=(t=n.hlCenter)?t:"[0,0]"),hlPopup:n.hlPopup})}),{config:l,configElement:e,renderElement:document.querySelector(l.hlRender)}})}function a(t){var n;const o=t.map;void 0!==o&&(o.setView(t.config.hlCenter,t.config.hlZoom),(null==(n=o.options.layers)?void 0:n.find(e=>"© OpenStreetMap contributors"===e.options.attribution))||e.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(o),o.eachLayer(t=>{t instanceof e.Marker&&t.removeFrom(o)}),t.config.markers.forEach(n=>{var r,i;const a=null!=(r=n.hlCenter)?r:t.config.hlCenter,l=null!=(i=n.hlPopup)?i:"",c=e.marker(a);c.setIcon(e.icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]})),""!==l&&c.bindPopup(l),c.addTo(o)}))}function l(r){r.forEach(r=>{const{configElement:i,renderElement:l,config:c}=r;if(null===l)return;const s=e.map(l);r.map=s,a(r),n[i.id]=t({},r,{configString:JSON.stringify(c)}),s.on("moveend",()=>{l.dispatchEvent(o(s))}),s.on("popupopen",e=>{const t={popup:e.popup.getElement()},n=new CustomEvent("hl-leaflet-popupopen",{detail:t});l.dispatchEvent(n)}),l.dispatchEvent(o(s))})}function c(e){e.forEach(e=>{const t=n[e.configElement.id];if(void 0===t)return;const{map:o}=t;if(void 0===o)return;const r=JSON.stringify(e.config);r!=t.configString&&(t.config=e.config,t.configString=r,a(t))})}window.addEventListener("load",()=>{l(i()),new MutationObserver(()=>c(i())).observe(document.body,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["data-hl-center","data-hl-zoom","data-hl-render","data-hl-popup"]})});var s={findMaps:i,initMaps:l,updateMaps:c,mapCache:n,apply:a,syncMove:function(e,o){e.setAttribute("data-hl-center",JSON.stringify(o.center)),e.setAttribute("data-hl-zoom",JSON.stringify(o.zoom)),e.setAttribute("data-hl-bounds",JSON.stringify(o.bounds));const r=n[e.id];void 0!==r&&(r.config=t({},r.config,{hlCenter:o.center,hlZoom:o.zoom}),r.configString=JSON.stringify(r.config))}};export{s as default};
//# sourceMappingURL=hl-leaflet.modern.mjs.map
