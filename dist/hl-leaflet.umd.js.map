{"version":3,"file":"hl-leaflet.umd.js","sources":["../src/hl-leaflet.ts"],"sourcesContent":["const mapCache = {} as Record<string, HlMap>\n\ntype HlMapConfig = {\n    hlRender: string,\n    hlCenter: string,\n    hlZoom: string,\n    markers: HlMarkerConfig[]\n}\n\ntype HlMarkerConfig = {\n    hlCenter?: string,\n    hlPopup?: string,\n}\n\ntype HlMap = {\n    config: HlMapConfig\n    configElement: HTMLElement,\n    renderElement: HTMLElement | null,\n    map?: L.Map,\n    configString?: string,\n}\n\nfunction els(nodes: NodeListOf<Element>): HTMLElement[] {\n    return Array.prototype.slice.call(nodes)\n}\n\nfunction findMaps(): HlMap[] {\n    const maps = els(document.body.querySelectorAll(\".hl-map\"))\n    return maps.map((map) => {\n        const dataset = map.dataset\n\n        // Basic config\n        const data: HlMapConfig = {\n            hlRender: dataset.hlRender ?? \"\",\n            hlCenter: dataset.hlCenter ?? \"[0,0]\",\n            hlZoom: dataset.hlZoom ?? \"10\",\n            markers: [] as HlMarkerConfig[]\n        }\n\n        // Detect markers\n        els(map.querySelectorAll(\".hl-marker\")).forEach((marker) => {\n            const markerData = marker.dataset as HlMarkerConfig\n            data.markers.push({\n                hlCenter: markerData.hlCenter,\n                hlPopup: markerData.hlPopup\n            })\n        })\n\n        return {\n            config: data,\n            configElement: map,\n            renderElement: document.querySelector(data.hlRender)\n        }\n    })\n}\n\n\nfunction apply(\n    map: HlMap,\n) {\n    const lMap = map.map\n    if (lMap === undefined) return\n    const center = map.config.hlCenter\n    const zoom = map.config.hlZoom\n\n    lMap.setView(JSON.parse(center), parseInt(zoom))\n\n    // Layers\n    const hasLayer = lMap.options.layers?.find((layer) =>\n        layer.options.attribution === \"© OpenStreetMap contributors\"\n    )\n    if (!hasLayer) L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '© OpenStreetMap contributors'\n    }).addTo(lMap);\n\n\n    // Remove layers\n    lMap.eachLayer((layer) => {\n        if (layer instanceof L.Marker) {\n            layer.removeFrom(lMap)\n        }\n    })\n\n    // Markers\n    map.config.markers.forEach((marker) => {\n        const center = marker.hlCenter ?? map.config.hlCenter\n        const popup = marker.hlPopup ?? \"\"\n        const markerLayer = L.marker(JSON.parse(center))\n        markerLayer.setIcon(L.icon({\n            iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\n            iconSize: [25, 41],\n            iconAnchor: [12, 41],\n            popupAnchor: [1, -34],\n        }))\n        if (popup !== \"\") markerLayer.bindPopup(popup)\n        markerLayer.addTo(lMap)\n    })\n}\n\nwindow.addEventListener(\"load\", () => {\n    const maps = findMaps()\n    maps.forEach((map) => {\n        const {configElement, renderElement, config} = map\n        if (renderElement === null) return\n        const lMap = L.map(renderElement)\n        map.map = lMap\n        apply(map)\n        mapCache[configElement.id] = {\n            ...map,\n            configString: JSON.stringify(config),\n        }\n\n        // Bind events\n        lMap.on(\"moveend\", () => {\n            const center = lMap.getCenter()\n            const zoom = lMap.getZoom()\n            const event = new CustomEvent(\"hl-leaflet-moveend\", {\n                detail: {\n                    center: [center.lat, center.lng],\n                    zoom: zoom\n                }\n            })\n            renderElement.dispatchEvent(event)\n        })\n\n        lMap.on(\"popupopen\", (e) => {\n            const event = new CustomEvent(\"hl-leaflet-popupopen\", {\n                detail: {\n                    popup: e.popup.getElement()\n                }\n            })\n            renderElement.dispatchEvent(event)\n        })\n    })\n    const observer = new MutationObserver(() => {\n            findMaps().forEach((map) => {\n                const cached = mapCache[map.configElement.id]\n                if (cached === undefined) return\n                const {map: lMap} = cached\n                if (lMap === undefined) return\n                const configString = JSON.stringify(map.config)\n                if (configString == cached.configString) return\n                cached.config = map.config\n                cached.configString = configString\n                apply(cached)\n            })\n        }\n    )\n    observer.observe(document.body, {\n        childList: true,\n        subtree: true\n    })\n})\n"],"names":["mapCache","els","nodes","Array","prototype","slice","call","findMaps","document","body","querySelectorAll","map","_dataset$hlRender","_dataset$hlCenter","_dataset$hlZoom","dataset","data","hlRender","hlCenter","hlZoom","markers","forEach","marker","markerData","push","hlPopup","config","configElement","renderElement","querySelector","apply","_lMap$options$layers","lMap","undefined","zoom","setView","JSON","parse","parseInt","options","layers","find","layer","attribution","L","tileLayer","addTo","eachLayer","Marker","removeFrom","_marker$hlCenter","_marker$hlPopup","center","popup","markerLayer","setIcon","icon","iconUrl","iconSize","iconAnchor","popupAnchor","bindPopup","window","addEventListener","id","_extends","configString","stringify","on","getCenter","getZoom","event","CustomEvent","detail","lat","lng","dispatchEvent","e","getElement","MutationObserver","cached","observe","childList","subtree"],"mappings":"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"}